# Author: Philip Weigel

record(ao, "REK-$(UNITNUM):voltage:set") {
    field(DESC, "Set voltage of $(PORT):$(UNITNUM)")
    field(DTYP, "stream")
    field(OUT, "@rek.proto set_voltage($(UNITNUM)) $(PORT)")
    field(DRVL, "0")
    field(DRVH, "150")
    field(EGU,  "V")
    field(LINR, "SLOPE")
    field(ESLO, "0.00228885") # 150/0xFFFF
    field(EOFF, "0")
}

record(ai, "REK-$(UNITNUM):voltage:get") {
    field(DESC, "Get voltage of $(PORT):$(UNITNUM)")
    field(DTYP, "stream")
    field(INP, "@rek.proto get_voltage($(UNITNUM)) $(PORT)")
    field(SCAN, ".1 second")
    field(EGU,  "V")
    field(LINR, "SLOPE")
    field(ESLO, "0.00228885") # 150/0xFFFF
    field(EOFF, "0")
}

record(ai, "REK-$(UNITNUM):voltage:read") {
    field(DESC, "Read voltage of $(PORT):$(UNITNUM)")
    field(DTYP, "stream")
    field(INP, "@rek.proto read_voltage($(UNITNUM)) $(PORT)")
    field(SCAN, ".1 second")
    field(EGU,  "V")
    field(LINR, "SLOPE")
    field(ESLO, "0.03663") # 150/0xFFF
    field(EOFF, "0")
}

record(ao, "REK-$(UNITNUM):current:set") {
    field(DESC, "Set current of $(PORT):$(UNITNUM)")
    field(DTYP, "stream")
    field(OUT, "@rek.proto set_current($(UNITNUM)) $(PORT)")
    field(DRVL, "0")
    field(DRVH, "24")
    field(EGU, "A")
    field(LINR, "SLOPE")
    field(ESLO, "0.000366217") # 24/0xFFFF
    field(EOFF, "0")
}

record(ai, "REK-$(UNITNUM):current:get") {
    field(DESC, "Get current of $(PORT):$(UNITNUM)")
    field(DTYP, "stream")
    field(INP, "@rek.proto get_current($(UNITNUM)) $(PORT)")
    field(SCAN, ".1 second")
    field(EGU, "mA")
    field(LINR, "SLOPE")
    field(ESLO, "0.000366217") # 24/0xFFFF
    field(EOFF, "0")
}

record(ai, "REK-$(UNITNUM):current:read") {
    field(DESC, "Read current of $(PORT):$(UNITNUM)")
    field(DTYP, "stream")
    field(INP, "@rek.proto read_current($(UNITNUM)) $(PORT)")
    field(SCAN, ".1 second")
    field(EGU, "mA")
    field(LINR, "SLOPE")
    field(ESLO, "0.00586081") # 24/0xFFF
    field(EOFF, "0")
}


record(bo, "REK-$(UNITNUM):enable") {
    field(DESC, "enable")
    field(DTYP, "stream")
    field(OUT, "@rek.proto enable_output($(UNITNUM)) $(PORT)")
}

record(bo, "REK-$(UNITNUM):disable") {
    field(DESC, "disable")
    field(DTYP, "stream")
    field(OUT, "@rek.proto disable_output($(UNITNUM)) $(PORT)")
}

record(bo, "REK-$(UNITNUM):status:set") {
    field(DESC, "Set status of $(PORT)$(UNITNUM)")
    field(DTYP, "stream")
    field(OUT, "@rek.proto set_status($(UNITNUM)) $(PORT)")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
}

record(bi, "REK-$(UNITNUM):status:read") {
    field(DESC, "Read status of $(PORT):$(UNITNUM)")
    field(DTYP, "stream")
    field(INP, "@rek.proto read_status($(UNITNUM)) $(PORT)")
    field(SCAN, ".1 second")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
}

record(bo, "REK-$(UNITNUM):reset") {
    field(DESC, "Reset cutoff of $(PORT):$(UNITNUM)")
    field(DTYP, "stream")
    field(OUT, "@rek.proto reset($(UNITNUM)) $(PORT)")
}

record(calc, "REK-$(UNITNUM):power:read") {
  field(DESC, "Read power of $(PORT):$(UNITNUM)")
   field(INPA, "REK-$(UNITNUM):voltage:read.VAL NPP")
   field(INPB, "REK-$(UNITNUM):current:read.VAL NPP")
   field(CALC, "A * B")
   field(SCAN, ".1 second")
   field(PREC, "3")
   field(EGU, "W")
}

